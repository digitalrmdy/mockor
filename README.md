# mockor

Generic mocker method generator for [mockito](https://pub.dev/packages/mockito) or [mocktail](https://pub.dev/packages/mocktail).
One `mock` method to mock any class just like in the original [mockito](https://site.mockito.org/). 

[![Pub Package](https://img.shields.io/pub/v/mockor.svg)](https://pub.dev/packages/mockor).

## Getting Started

### Add the dependencies

```yaml
dev_dependencies:
  mockor: ^1.0.0

```

### Add a `mocker.dart` file in your test folder and a mock method with a `@GenerateMocker` annotation. Don't forget to import [mockito](https://pub.dev/packages/mockito) here.

```dart

// This import is used by the generated mockor file to add Mockito's `@GenerateMocks` annotation.
// This need to be added manually.
import 'package:mockito/annotations.dart';

// <file_name>.mocks.dart will be generated by Mockito which contain all the generated mocks.
// This needs to be added manually.
import 'example.mocks.dart';

import 'package:mockor/annotations.dart';

part 'example.mockor.dart';

abstract class ExampleUseCase {
  int example(int i);
}

abstract class ExampleUseCase2 {
  void example2();
}

@GenerateMocker([
  ExampleUseCase,
  ExampleUseCase2,
])
T mock<T extends Object>() => _$mock<T>();
```

### To use the generated mocks, simply import and call the defined mock function

```dart
import '../../mocker.dart';

void main() {
  late ExampleUseCase exampleUseCase;
  late ExampleUseCase2 exampleUseCase2;

  setUp(() {
    // this will return [MockExampleUseCase]
    exampleUseCase = mock();
    exampleUseCase2 = mock();
  });
}
```

for more info check out the [example](https://github.com/digitalrmdy/mockito-builder/tree/master/example) module.

## Getting Started using [mocktail](https://pub.dev/packages/mocktail)
### Follow steps like before with slight modifications to `mocker.dart` file

```dart
// This import will be used for generating the mocks.
// This needs to be added manually. 
import 'package:mocktail/mocktail.dart';

import 'package:mockor/annotations.dart';

part 'mocker.mockor.dart';

@GenerateMocker(
  [
    ExampleUseCase,
    ExampleUseCase2,
  ],
  generateMockExtensions: false,
  generateMockitoAnnotation: false,
  useMockitoGeneratedTypes: false,
)
T mock<T extends Object>() => _$_mock<T>();

```

## Main Advantage over vanilla Mockito
You can always work with the base type:
- Renaming the class will not break tests.
- Find usages will not miss anything
- Never have to import/depend on mocks directly

### The main downside is that you need to use a generated `asMock` extension method to make use of the `any` keyword.

```dart
extension ExampleUseCaseAsMockExtension on ExampleUseCase {
  MockExampleUseCase asMock() => this as MockExampleUseCase;
}
```
Then in your test:
```dart  
abstract class ExampleUseCase {
  int example(int i);
}
final ExampleUseCase useCase = mock();
// asMock required becuase int i is non null and `any` returns null. the method is overriden with a nullable param in MockExampleUseCase.
when(useCase.asMock().example(any)).thenReturn(1)
``` 
Please read Mockito's [Null Safety README](https://github.com/dart-lang/mockito/blob/master/NULL_SAFETY_README.md) for more info.
## Advantage over vanilla Mocktail
The main selling point of vanilla Mocktail is that code generation is not required.
Here code generation is required but only for the one file with the generic mock function.
There's no dependency to generated code in any of your tests. And each mock class is only 1 line.

## FAQ
### How can I hide the generated mock classes from auto import?

in the root of your project add an `analysis_options.yaml` with following content:
```yaml  
analyzer:
  exclude:
    - '**/*.mocks.dart' # Mockito @GenerateMocks
``` 

## Troubleshooting
### "Error, a mock class for 'MockExampleUseCase' has not been generated yet."

The mocker method only supports returning a mock instance for it's base type.

### Error when using `any`: "The argument type 'Null' can't be assigned to the parameter type..."

For the cases where you use `any`, make use of the `asMock` extension.
It's explained more in depth in the advantage/disadvantage section above.